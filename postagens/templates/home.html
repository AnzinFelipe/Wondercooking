{% extends "base.html" %}
{% load static %}
{% load app_extra %}

{% block title %}Todos os posts - Wondercooking{% endblock %}

{% block conteudo %}
  <h1>Bem vindo ao Wondercooking!</h1>

  <div class="actions-top">
    <h2><a href="{% url 'criar_post' %}" class="btn btn-primary">Criar uma postagem</a></h2>
  </div>

  {% if posts %}
    <div class="posts-grid">
      {% for post in posts %}
        <article class="post">
          <a href="{% url 'post_detalhe' post.id %}">
            <h3>{{ post.titulo }}</h3>
          </a>

          <p>
            <strong>Autor:</strong>
            {% if post.autor and post.autor.user %}
              {{ post.autor.user.username }}
            {% else %}
              An√¥nimo
            {% endif %}
          </p>

          <p><strong>Postado em:</strong> {{ post.data|date:"d/m/Y H:i" }}</p>

          <p>{{ post.descricao|link_hashtags }}</p>

          {% if post.imagem %}
            {% if post.imagem.url %}
              <img class="post-image" src="{{ post.imagem.url }}" alt="{{ post.titulo }}" loading="lazy">
            {% else %}
              <div class="post-image" style="display:flex;align-items:center;justify-content:center;background:#f3f3f7;color:#777;border-radius:10px;">
                Sem imagem
              </div>
            {% endif %}
          {% else %}
            <div class="post-image" style="display:flex;align-items:center;justify-content:center;background:#f3f3f7;color:#777;border-radius:10px;">
              Sem imagem
            </div>
          {% endif %}

          {% if post.hashtag_set.all %}
            <p class="post-tags">Tags:
            {% for ht in post.hashtag_set.all %}
              <a href="{% url 'tags' ht.hashtagnome %}">#{{ ht.hashtagnome }}</a>{% if not forloop.last %}, {% endif %}
            {% endfor %}
            </p>
          {% endif %}

          <div class="post-footer">
            {% if user.is_authenticated %}
              <form method="post" action="{% url 'like_post' post.id %}">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.get_full_path }}">
                <button type="submit">
                  {% if request.user in post.likes.all %}üëç Curtido{% else %}üëç Curtir{% endif %}
                  ({{ post.likes.count }})
                </button>
              </form>

              <form method="post" action="{% url 'favorite_post' post.id %}">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.get_full_path }}">
                <button type="submit">
                  {% if request.user in post.favoritos.all %}‚òÖ Favoritado{% else %}‚òÜ Favoritar{% endif %}
                </button>
              </form>
            {% else %}
              <a href="{% url 'login' %}" class="btn">üëç Curtir</a>
              <a href="{% url 'login' %}" class="btn">‚òÜ Favoritar</a>
            {% endif %}
          </div>
        </article>
      {% endfor %}
    </div>
  {% else %}
    <p>Nenhum post encontrado.</p>
  {% endif %}
{% endblock %}